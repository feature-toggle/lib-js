function FeatureToggleCache(e){var t;t="session"===e.cache_storage?sessionStorage:localStorage,this.manager="undefined"!=typeof t?t:null,this.keys={},this.options=e}function FeatureToggle(e,t,s){if(void 0===s&&(s={}),this.VERSION="1.0",this.customerKey=e,this.environmentKey=t,this.options=this.extend({api:"https://api.featuretoggle.com",auth:null,cache_timeout:300,version:"v1",debug:!1,cache_keys_name:"featuretoggle-cache"},s),this.options.auth=this.customerKey+":"+this.environmentKey,this.cache=new FeatureToggleCache(this.options),this.cache.manager){var a=this.cache.get(this.options.cache_keys_name);a&&(this.cache.keys=a)}}!function(){"use strict"}(),FeatureToggleCache.prototype.clear=function(){this.manager.clear(),this.keys={},this.updateKeys()},FeatureToggleCache.prototype.get=function(e){if(this.manager)if("undefined"!=typeof this.keys[e]){if(this.keys[e]<Math.floor(Date.now()/1e3))return JSON.parse(this.manager.getItem(e))}else if(e===this.options.cache_keys_name)return JSON.parse(this.manager.getItem(e));return null},FeatureToggleCache.prototype.set=function(e,t){if(this.manager){e!==this.options.cache_keys_name&&"undefined"==typeof this.keys[e]&&(this.keys[e]=Math.floor(Date.now()/1e3)+this.options.cache_timeout);var s=this.get(e);JSON.stringify(s)!==JSON.stringify(t)&&(this.manager.setItem(e,JSON.stringify(t)),this.manager.getItem(e),e!==this.options.cache_keys_name&&this.updateKeys())}},FeatureToggleCache.prototype.remove=function(e){this.manager&&this.manager.removeItem(e),e!==this.options.cache_keys_name&&this.updateKeys()},FeatureToggleCache.prototype.updateKeys=function(){this.set(this.options.cache_keys_name,this.keys)},FeatureToggle.prototype.extend=function(e,t){return void 0!==Object.assign?Object.assign(e,t):(Object.keys(t).forEach(function(s){e[s]=t[s]}),e)},FeatureToggle.prototype.apiRequest=function(e,t){var s=new XMLHttpRequest;s.open("GET",this.options.api+e),s.setRequestHeader("Authorization",this.options.auth),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("X-Accept-Version",this.options.version),s.setRequestHeader("User-Agent","FeatureToggle-JS/"+this.VERSION),s.onreadystatechange=function(){if(4===s.readyState){var e=JSON.parse(s.responseText),a={success:!1,message:""};switch(s.status){case 200:for(var i in e)void 0!==e[i]&&(a[i]=e[i]);break;default:a.message=e.error.message}t(a)}},s.send(null)},FeatureToggle.prototype.getFeatures=function(e){var t=this,s=t.cache.get("features");null!==s?e(null,s):this.apiRequest("/features",function(s){"undefined"!=typeof s.features?(t.cache.set("features",s.features),e(null,s.features)):e(s.message,null)})},FeatureToggle.prototype.isEnabled=function(e,t){var s=this;this.apiRequest("/features/"+e,function(a){"undefined"!=typeof a.enabled?(s.cache.set(e,a.enabled),t(null,a.enabled)):t(a.message,null)})};